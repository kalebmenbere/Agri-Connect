{% extends 'base.html' %}
{% block content %}
{% load static %}

<!-- Single Page Header start -->
<div class="container-fluid page-header py-5">
    <h1 class="text-center text-white display-6">Create Account</h1>
    <ol class="breadcrumb justify-content-center mb-0">
        <li><a href="{% url 'home' %}" style="color: #ffffff;">Home</a>  </li>
        <li class="breadcrumb-item active text-white">&nbsp;/&nbsp;Register</li>
    </ol>
</div>

<!-- Single Page Header End -->

<!-- Registration Form Start -->
<div class="container-fluid py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-lg border-0 rounded-lg">
                    <div class="card-body p-5">
                        <div class="text-center mb-5">
                            <h1 class="fw-bold text-green">Join Agri-Connect</h1>
                            <p class="text-muted">Create your account to get started</p>
                        </div>
                        
                        <form method="POST" action="{% url 'register' %}" id="registrationForm" class="needs-validation" novalidate>
                            {% csrf_token %}
                            
                            <div class="row">
                                <!-- First Name -->
                                <div class="col-md-6 mb-4">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="first_name" name="first_name" placeholder="First Name" required>
                                        <label for="first_name">First Name</label>
                                        <div class="invalid-feedback">Please enter your first name.</div>
                                    </div>
                                </div>
                                
                                <!-- Last Name -->
                                <div class="col-md-6 mb-4">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="last_name" name="last_name" placeholder="Last Name" required>
                                        <label for="last_name">Last Name</label>
                                        <div class="invalid-feedback">Please enter your last name.</div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <!-- Username -->
                                <div class="col-md-6 mb-4">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="username" name="username" placeholder="Username" required>
                                        <label for="username">Username</label>
                                        <div class="invalid-feedback">Please choose a username.</div>
                                    </div>
                                </div>
                                
                                <!-- Email -->
                                <div class="col-md-6 mb-4">
                                    <div class="form-floating">
                                        <input type="email" class="form-control" id="email" name="email" placeholder="Email" required>
                                        <label for="email">Email Address</label>
                                        <div class="invalid-feedback">Please enter a valid email address.</div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <!-- Role -->
                                <div class="col-md-6 mb-4">
                                    <div class="form-floating">
                                        <select class="form-select" id="role" name="role" required>
                                            <option value="">Select Role</option>
                                            <option value="farmer">Farmer</option>
                                            <option value="buyer">Buyer</option>
                                        </select>
                                        <label for="role">Your Role</label>
                                        <div class="invalid-feedback">Please select your role.</div>
                                    </div>
                                </div>
                                
                                <!-- Phone -->
                                <div class="col-md-6 mb-4">
                                    <div class="form-floating">
                                        <input type="tel" class="form-control" id="phone" name="phone" placeholder="Phone" pattern="[0-9]{10}" required>
                                        <label for="phone">Phone Number</label>
                                        <div class="invalid-feedback">Please enter a valid 10-digit phone number.</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Location Region -->
                            <div class="mb-3">
                                <select name="region" id="region" class="form-control border-0 py-3" required>
                                    <option value="">Select Region</option>
                                    <option value="Addis Ababa">Addis Ababa</option>
                                    <option value="Afar">Afar</option>
                                    <option value="Amhara">Amhara</option>
                                    <option value="Benishangul-Gumuz">Benishangul-Gumuz</option>
                                    <option value="Dire Dawa">Dire Dawa</option>
                                    <option value="Gambela">Gambela</option>
                                    <option value="Harari">Harari</option>
                                    <option value="Oromia">Oromia</option>
                                    <option value="Sidama">Sidama</option>
                                    <option value="SNNP">SNNP</option>
                                    <option value="Somali">Somali</option>
                                    <option value="Tigray">Tigray</option>
                                </select>
                            </div>
                            <!-- Location Zone -->
                            <div class="mb-3">
                                <select name="zone" id="zone" class="form-control border-0 py-3" required disabled>
                                    <option value="">Select Zone</option>
                                </select>
                            </div>

                            <!-- Password -->
                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <div class="form-floating">
                                        <input type="password" class="form-control" id="password1" name="password1" placeholder="Password" required>
                                        <label for="password1">Password</label>
                                        <div class="invalid-feedback" id="password1Feedback">
                                            Password must be at least 8 characters and include numbers and special characters.
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-4">
                                    <div class="form-floating">
                                        <input type="password" class="form-control" id="password2" name="password2" placeholder="Confirm Password" required>
                                        <label for="password2">Confirm Password</label>
                                        <div class="invalid-feedback">Passwords do not match.</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Password Requirements -->
                            <div class="mb-4">
                                <div class="password-requirements small">
                                    <p class="mb-2">Password must contain:</p>
                                    <ul class="list-unstyled">
                                        <li id="length-check" class="text-muted">
                                            <i class="bi bi-x-circle"></i> At least 8 characters
                                        </li>
                                        <li id="number-check" class="text-muted">
                                            <i class="bi bi-x-circle"></i> At least one number
                                        </li>
                                        <li id="special-check" class="text-muted">
                                            <i class="bi bi-x-circle"></i> At least one special character
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <!-- Terms Checkbox -->
                            <div class="mb-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="termsCheck" name="is_agreed" required>
                                    <label class="form-check-label" for="termsCheck">
                                        I agree to the <a href="{% url 'policy' %}" class="text-decoration-none text-green">Terms of Service</a> and 
                                        <a href="{% url 'policy' %}" class="text-decoration-none text-green">Privacy Policy</a>
                                    </label>
                                    <div class="invalid-feedback">
                                        You must agree to the Terms of Service and Privacy Policy.
                                    </div>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="d-grid gap-2 mb-4 ">
                                <button type="submit" class="btn btn-success btn-lg" id="registerBtn" disabled>
                                    Create Account
                                </button>
                            </div>

                            <!-- Login Link -->
                            <div class="text-center">
                                <p class="mb-0">Already have an account? <a href="{% url 'login' %}" class="text-decoration-none text-green">Login here</a></p>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Registration Form End -->
 


<!-- Validation Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('registrationForm');
    const password1 = document.getElementById('password1');
    const password2 = document.getElementById('password2');
    const registerBtn = document.getElementById('registerBtn');
    const termsCheck = document.getElementById('termsCheck');
    
    // Password requirement checks
    const lengthCheck = document.getElementById('length-check');
    const numberCheck = document.getElementById('number-check');
    const specialCheck = document.getElementById('special-check');
    

    
    // Real-time password validation
    function validatePassword() {
        const password = password1.value;
        const confirmPassword = password2.value;
        
        // Check length
        if (password.length >= 8) {
            lengthCheck.classList.remove('text-muted');
            lengthCheck.classList.add('text-success');
            lengthCheck.querySelector('i').classList.replace('bi-x-circle', 'bi-check-circle-fill');
        } else {
            lengthCheck.classList.remove('text-success');
            lengthCheck.classList.add('text-muted');
            lengthCheck.querySelector('i').classList.replace('bi-check-circle-fill', 'bi-x-circle');
        }
        
        // Check number
        if (/\d/.test(password)) {
            numberCheck.classList.remove('text-muted');
            numberCheck.classList.add('text-success');
            numberCheck.querySelector('i').classList.replace('bi-x-circle', 'bi-check-circle-fill');
        } else {
            numberCheck.classList.remove('text-success');
            numberCheck.classList.add('text-muted');
            numberCheck.querySelector('i').classList.replace('bi-check-circle-fill', 'bi-x-circle');
        }
        
        // Check special character
        if (/[!@#$%^&*]/.test(password)) {
            specialCheck.classList.remove('text-muted');
            specialCheck.classList.add('text-success');
            specialCheck.querySelector('i').classList.replace('bi-x-circle', 'bi-check-circle-fill');
        } else {
            specialCheck.classList.remove('text-success');
            specialCheck.classList.add('text-muted');
            specialCheck.querySelector('i').classList.replace('bi-check-circle-fill', 'bi-x-circle');
        }
        
        // Check if passwords match
        if (password === confirmPassword && confirmPassword !== '') {
            password2.classList.remove('is-invalid');
            password2.classList.add('is-valid');
        } else {
            password2.classList.remove('is-valid');
            if (confirmPassword !== '') {
                password2.classList.add('is-invalid');
            }
        }
        
        // Enable/disable register button
        const isValid = password.length >= 8 && 
                       /\d/.test(password) && 
                       /[!@#$%^&*]/.test(password) && 
                       password === confirmPassword && 
                       confirmPassword !== '' && 
                       termsCheck.checked;
        
        registerBtn.disabled = !isValid;
    }
    
    // Add validation to all form fields
    const inputs = form.querySelectorAll('input:not([type="hidden"]), select');
    inputs.forEach(input => {
        input.addEventListener('input', function() {
            if (this.checkValidity()) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
            } else {
                this.classList.remove('is-valid');
                this.classList.add('is-invalid');
            }
        });
    });
    
    // Phone number validation
    const phoneInput = document.getElementById('phone');
    phoneInput.addEventListener('input', function() {
        this.value = this.value.replace(/\D/g, '').substring(0, 10);
    });
    
    // Add event listeners
    password1.addEventListener('input', validatePassword);
    password2.addEventListener('input', validatePassword);
    termsCheck.addEventListener('change', validatePassword);
    
    // Form submission
    form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }
        form.classList.add('was-validated');
    });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Ethiopian Regions and Zones data
    const ethiopiaData = {
    'Addis Ababa': ['Addis Ketema', 'Akaky Kaliti', 'Arada', 'Bole', 'Gulele', 'Kirkos', 'Kolfe Keranio', 'Lideta', 'Nifas Silk-Lafto', 'Yeka'],
    'Afar': ['Semera', 'Awash', 'Asayita', 'Logia', 'Dubti'],
    'Amhara': ['Bahir Dar', 'Gondar', 'Dessie', 'Debre Markos', 'Kombolcha', 'Debre Birhan', 'Weldiya', 'Lalibela', 'Finote Selam', 'Debre Tabor', 'Guba Lafto', 'Bati', 'Woldia', 'Sekota', 'Dabat', 'Debre Sina'],
    'Benishangul-Gumuz': ['Assosa', 'Bambasi', 'Mankush', 'Gilgel Beles'],
    'Dire Dawa': ['Dire Dawa', 'Deder', 'Chiro', 'Babile', 'Mieso', 'Kersa', 'Mena'],
    'Gambela': ['Gambela', 'Abobo', 'Itang', 'Mettu', 'Lare', 'Jikawo', 'Akobo'],
    'Harari': ['Harar', 'Babile', 'Chiro', 'Deder', 'Harar Meda', 'Kersa', 'Mieso', 'Mena'],
    'Oromia': ['Adama', 'Jimma', 'Ambo', 'Shashamene', 'Bishoftu', 'Nazret', 'Nekemte', 'Asella', 'Debre Zeyit', 'Hossana', 'Woliso', 'Agaro', 'Bale Robe', 'Bedele', 'Gimbi', 'Bako', 'Dembi Dolo', 'Fincha', 'Gindhir', 'Harar Meda', 'Kofele', 'Mettu', 'Shakiso', 'Wollega', 'Yabelo'],
    'Sidama': ['Hawassa', 'Yirgalem', 'Hagere Selam', 'Bensa', 'Arsi Negele'],
    'SNNP': ['Arba Minch', 'Wolayita Sodo', 'Hossana', 'Jinka', 'Sawla', 'Boditi', 'Areka', 'Chencha', 'Dilla'],
    'Somali': ['Jijiga', 'Dollo', 'Degehabur', 'Gode', 'Kebri Dehar', 'Fik', 'Warder'],
    'Tigray': ['Axum', 'Adigrat', 'Shire (Inda Selassie)', 'Alamata', 'Wukro', 'Adwa', 'Hawzen', 'Mekele', 'Enderta', 'Tsegede', 'Laelay Adiyabo', 'Degua Tembien', 'Saharti Samre', 'Ofla', 'Kilte Awlalo']
    };

    const regionSelect = document.getElementById('region');
    const zoneSelect = document.getElementById('zone');

    // Update zones when region changes
    regionSelect.addEventListener('change', function() {
        const selectedRegion = this.value;
        const zones = ethiopiaData[selectedRegion] || [];
        
        // Reset zone select
        zoneSelect.innerHTML = '<option value="">Select Zone</option>';
        zoneSelect.disabled = !zones.length;
        
        // Add new zone options
        zones.forEach(zone => {
            zoneSelect.add(new Option(zone, zone));
        });
    });
});
</script>

{% endblock %}