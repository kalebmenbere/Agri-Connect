{% extends 'dashboard/include/navbar.html' %}
{% load static %}
{% block content %}

<!-- Page Title -->
<div class="pagetitle">
  <h1>Activity Log Detail</h1>
  <nav>
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'admin_dashboard' %}">Home</a></li>
      <li class="breadcrumb-item active">Detail</li>
    </ol>
  </nav>
</div>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="card">
  <div class="card-body">
    <h5 class="card-title">Details for Log ID {{ log.id }}</h5>
    <ul>
      <li><strong>User:</strong> {{ log.user.username }}</li>
      <li><strong>Action:</strong> {{ log.get_action_display }}</li>
      <li><strong>Description:</strong> {{ log.description }}</li>
      <li><strong>Timestamp:</strong> {{ log.timestamp }}</li>
      <li><strong>Product:</strong> {{ log.product.name|default:"N/A" }}</li>
      <li><strong>Additional Info:</strong>
        {% if log.additional_data %}
          <ul>
            {% for key, value in log.additional_data.items %}
              <li><strong>{{ key|capfirst }}:</strong> {{ value }}</li>
            {% endfor %}
          </ul>
        {% else %}
          N/A
        {% endif %}
      </li>
    </ul>

    <!-- Buttons -->
    <div class="mt-4 d-flex gap-2">
      <!-- Go Back -->
      <a href="{% url 'activity_log_filtered' log.action %}" class="btn btn-secondary">‚Üê Back to Logs</a>

      <!-- Delete -->
      <form id="delete-log-form-{{ log.id }}" method="post" action="{% url 'activity_log_delete' log_id=log.id action=log.action %}">
        {% csrf_token %}
        <button type="button" class="btn btn-danger" onclick="confirmDeleteLog('{{ log.id }}')">Delete</button>
      </form>
    </div>
  </div>
</div>

<!-- Delete Confirmation Script -->
<script>
  function confirmDeleteLog(logId) {
    Swal.fire({
      title: 'Are you sure?',
      text: "This log will be permanently deleted!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#6c757d',
      confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
      if (result.isConfirmed) {
        document.getElementById('delete-log-form-' + logId).submit();
      }
    });
  }
</script>

{% endblock %}
